version: 2
jobs:
  deploy-helm-charts:
    docker:
      # - image: praqma/helmsman:v1.3.0-rc
      - image: praqma/helmsman:v1.2.0
    steps:
      - checkout
      - run: 
          name: make .kube directory
          command: mkdir ~/.kube
      - run: 
          name: setup .kube/config file using env variable
          command: echo $KUBECTL_CONFIG | base64 -d > ~/.kube/config
      - run: ls -la ~/.kube
      - run: 
          name: run kubectl get nodes to verify we can talk to the cluster
          command: kubectl get nodes
      - run: 
          name: deploy helm charts using helmsman
          command: helmsman -debug -apply -f helmsman-deployments.toml
workflows:
  version: 2
  build_and_deploy:
    jobs:
      - deploy-helm-charts
